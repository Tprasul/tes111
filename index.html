<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HR - Опрос</title>
  
  <!-- Стили -->
  <style>
    body {
      background-color: #f8f8f8;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
      padding: 20px;
      box-sizing: border-box;
    }
    .form-container {
      max-width: 600px;
      width: 100%;
      font-family: sans-serif;
      padding: 30px;
      border: 1px solid #ddd;
      border-radius: 12px;
      background-color: #FFE4E1; /* Light red/pink */
      box-shadow: 0 8px 20px rgba(0,0,0,0.1);
    }
    .avatar-img {
      width: 150px;
      height: 150px;
      border-radius: 50%;
      object-fit: cover;
      margin: 0 auto 20px auto; /* Centered */
      display: block;
      border: 3px solid #d32f2f; /* Matching button color */
      box-shadow: 0 0 15px rgba(0,0,0,0.15);
    }
    .form-title {
      font-size: 28px;
      font-weight: bold;
      text-align: center;
      margin-bottom: 30px;
      color: #333;
    }
    label {
      font-weight: bold;
      display: block;
      margin-top: 25px;
      margin-bottom: 12px;
      color: #555;
      line-height: 1.4;
    }
    input[type="text"], textarea {
      width: calc(100% - 24px); /* Adjust for padding/border */
      padding: 12px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 16px;
      box-sizing: border-box; /* Include padding/border in width */
    }
    textarea {
      resize: vertical; /* Allow vertical resizing */
      min-height: 80px;
    }
    .radio-group {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-bottom: 15px;
    }
    .radio-option {
      display: flex;
      align-items: center;
      gap: 12px;
      cursor: pointer;
      padding: 10px;
      border-radius: 8px;
      background-color: #fdf5e6; /* Lighter background for options */
      transition: background-color 0.2s ease;
    }
    .radio-option:hover {
      background-color: #faebd7;
    }
    .radio-option input[type="radio"] {
      display: none;
    }
    .custom-radio {
      flex-shrink: 0; /* Prevent shrinking */
      width: 35px; /* Slightly smaller for better visual balance */
      height: 35px;
      background-color: #eee;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      color: #333;
      border: 2px solid transparent;
      transition: 0.2s;
      font-size: 18px;
    }
    .radio-option input[type="radio"]:checked + .custom-radio {
      border-color: #d32f2f;
      background-color: #d32f2f;
      color: white;
      box-shadow: 0 0 10px rgba(211, 47, 47, 0.5);
    }
    .submit-btn {
      margin-top: 40px;
      padding: 15px 25px;
      background-color: #d32f2f;
      color: white;
      font-size: 18px;
      font-weight: bold;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      width: 100%;
      transition: background-color 0.3s ease, transform 0.2s ease;
      box-shadow: 0 4px 10px rgba(211, 47, 47, 0.3);
    }
    .submit-btn:hover:not(:disabled) {
      background-color: #b71c1c;
      transform: translateY(-2px);
    }
    .submit-btn:disabled {
      background-color: #ff7f7f; /* Lighter red when disabled */
      cursor: not-allowed;
      box-shadow: none;
    }
    #cameraInput {
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 8px;
      width: calc(100% - 24px);
      box-sizing: border-box;
      margin-top: 10px;
    }
  </style>
  
  <!-- SweetAlert2 -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>
  
  <div class="form-container">
    <img src="https://i.imgur.com/SxzkAWe.jpeg" alt="Аватар" class="avatar-img">
    
    <div class="form-title">Опрос - КАССИР</div>
    <form id="customForm">
      <label for="yourName">Ваше имя:</label>
      <input type="text" id="yourName" name="yourName" required>
      
      <label for="employeeName">Имя сотрудника:</label>
      <input type="text" id="employeeName" name="employeeName" required>
      
      <label>Нет видимых признаков заболевания, которые могут послужить причиной для отстранения от работы:</label>
      <div class="radio-group">
        <label class="radio-option"><input type="radio" name="q1_health" value="Знает" required><div class="custom-radio">A</div> Знает</label>
        <label class="radio-option"><input type="radio" name="q1_health" value="Не знает"><div class="custom-radio">B</div> Не знает</label>
      </div>
      
      <label>Соблюдает правила мытья рук / правила использования перчаток при работе с продуктом:</label>
      <div class="radio-group">
        <label class="radio-option"><input type="radio" name="q2_hands" value="Знает" required><div class="custom-radio">A</div> Знает</label>
        <label class="radio-option"><input type="radio" name="q2_hands" value="Не знает"><div class="custom-radio">B</div> Не знает</label>
      </div>
      
      <label>Обеспечивает отсутствие перекрестного загрязнения:</label>
      <div class="radio-group">
        <label class="radio-option"><input type="radio" name="q3_cross_contam" value="Знает" required><div class="custom-radio">A</div> Знает</label>
        <label class="radio-option"><input type="radio" name="q3_cross_contam" value="Не знает"><div class="custom-radio">B</div> Не знает</label>
      </div>
      
      <label>Соблюдает прочие стандарты пищевой безопасности:</label>
      <div class="radio-group">
        <label class="radio-option"><input type="radio" name="q4_food_safety" value="Знает" required><div class="custom-radio">A</div> Знает</label>
        <label class="radio-option"><input type="radio" name="q4_food_safety" value="Не знает"><div class="custom-radio">B</div> Не знает</label>
      </div>
      
      <label>Проверяет сроки годности, просроченный продукт списывает. Недостающие продукты пополняет, используя правило ротации продуктов:</label>
      <div class="radio-group">
        <label class="radio-option"><input type="radio" name="q5_shelf_life" value="Знает" required><div class="custom-radio">A</div> Знает</label>
        <label class="radio-option"><input type="radio" name="q5_shelf_life" value="Не знает"><div class="custom-radio">B</div> Не знает</label>
      </div>
      
      <label>Соблюдает техники безопасности при работе с оборудованием:</label>
      <div class="radio-group">
        <label class="radio-option"><input type="radio" name="q6_safety_tech" value="Знает" required><div class="custom-radio">A</div> Знает</label>
        <label class="radio-option"><input type="radio" name="q6_safety_tech" value="Не знает"><div class="custom-radio">B</div> Не знает</label>
      </div>
      
      <label>Сообщает менеджеру о любых неисправностях оборудования:</label>
      <div class="radio-group">
        <label class="radio-option"><input type="radio" name="q7_equipment_issues" value="Знает" required><div class="custom-radio">A</div> Знает</label>
        <label class="radio-option"><input type="radio" name="q7_equipment_issues" value="Не знает"><div class="custom-radio">B</div> Не знает</label>
      </div>
      
      <label>Знает свои цели и задачи на смену:</label>
      <div class="radio-group">
        <label class="radio-option"><input type="radio" name="q8_shift_goals" value="Знает" required><div class="custom-radio">A</div> Знает</label>
        <label class="radio-option"><input type="radio" name="q8_shift_goals" value="Не знает"><div class="custom-radio">B</div> Не знает</label>
      </div>
      
      <label>Приветствует Гостей дружелюбными фразами и визуальным контактом:</label>
      <div class="radio-group">
        <label class="radio-option"><input type="radio" name="q9_greeting" value="Знает" required><div class="custom-radio">A</div> Знает</label>
        <label class="radio-option"><input type="radio" name="q9_greeting" value="Не знает"><div class="custom-radio">B</div> Не знает</label>
      </div>
      
      <label>Рассказывает Гостям о новинках, промо-акциях или спецпредложениях, применяет навыки активных продаж:</label>
      <div class="radio-group">
        <label class="radio-option"><input type="radio" name="q10_sales" value="Знает" required><div class="custom-radio">A</div> Знает</label>
        <label class="radio-option"><input type="radio" name="q10_sales" value="Не знает"><div class="custom-radio">B</div> Не знает</label>
      </div>
      
      <label>Демонстрирует хорошее знание меню, может красочно описать любое блюдо, предлагает эквивалентную замену при отсутствии какого-либо продукта:</label>
      <div class="radio-group">
        <label class="radio-option"><input type="radio" name="q11_menu_knowledge" value="Знает" required><div class="custom-radio">A</div> Знает</label>
        <label class="radio-option"><input type="radio" name="q11_menu_knowledge" value="Не знает"><div class="custom-radio">B</div> Не знает</label>
      </div>
      
      <label>Стандарты работы с кассой соблюдаются:</label>
      <div class="radio-group">
        <label class="radio-option"><input type="radio" name="q12_cashier_standards" value="Знает" required><div class="custom-radio">A</div> Знает</label>
        <label class="radio-option"><input type="radio" name="q12_cashier_standards" value="Не знает"><div class="custom-radio">B</div> Не знает</label>
      </div>
      
      <label>Контролирует точность сбора заказа:</label>
      <div class="radio-group">
        <label class="radio-option"><input type="radio" name="q13_order_accuracy" value="Знает" required><div class="custom-radio">A</div> Знает</label>
        <label class="radio-option"><input type="radio" name="q13_order_accuracy" value="Не знает"><div class="custom-radio">B</div> Не знает</label>
      </div>
      
      <label>При выдаче заказа, желает Гостю приятного аппетита (или произносит другую уместную фразу) и предлагает посетить ресторан снова.:</label>
      <div class="radio-group">
        <label class="radio-option"><input type="radio" name="q14_farewell" value="Знает" required><div class="custom-radio">A</div> Знает</label>
        <label class="radio-option"><input type="radio" name="q14_farewell" value="Не знает"><div class="custom-radio">B</div> Не знает</label>
      </div>
      
      <label>Соблюдает стандарты скорости обслуживания (прием, оплата, сбор и выдача заказа):</label>
      <div class="radio-group">
        <label class="radio-option"><input type="radio" name="q15_speed_service" value="Знает" required><div class="custom-radio">A</div> Знает</label>
        <label class="radio-option"><input type="radio" name="q15_speed_service" value="Не знает"><div class="custom-radio">B</div> Не знает</label>
      </div>
      
      <label>Поддерживает чистоту рабочей станций в течение всей смены:</label>
      <div class="radio-group">
        <label class="radio-option"><input type="radio" name="q16_cleanliness" value="Знает" required><div class="custom-radio">A</div> Знает</label>
        <label class="radio-option"><input type="radio" name="q16_cleanliness" value="Не знает"><div class="custom-radio">B</div> Не знает</label>
      </div>
      
      <label>Эффективная коммуникация со Скаутом и Менеджером:</label>
      <div class="radio-group">
        <label class="radio-option"><input type="radio" name="q17_communication" value="Знает" required><div class="custom-radio">A</div> Знает</label>
        <label class="radio-option"><input type="radio" name="q17_communication" value="Не знает"><div class="custom-radio">B</div> Не знает</label>
      </div>
      
      <label for="cameraInput">Сделать фото сотрудника:</label>
      <input type="file" id="cameraInput" name="cameraInput" accept="image/*" capture="environment" required class="form-control mb-3">
      
      <label for="comment">Комментарий:</label>
      <textarea id="comment" name="comment" rows="4" placeholder="Напишите свой комментарий..."></textarea>
      
      <button type="submit" class="submit-btn">Закончить опрос</button>
    </form>
  </div>
  
  <script>
    document.getElementById("customForm").addEventListener("submit", async function(event) {
      event.preventDefault(); // Предотвращаем стандартную отправку формы

      const btn = document.querySelector(".submit-btn");
      // Проверяем, если кнопка уже отключена, чтобы предотвратить повторные отправки
      if (btn.disabled) return; 

      btn.disabled = true;
      btn.textContent = "Отправка данных...";

      try {
        const form = event.target;
        const yourName = form.yourName.value.trim();
        const employeeName = form.employeeName.value.trim();
        const comment = form.comment.value.trim();
        const fileInput = document.getElementById("cameraInput");
        const file = fileInput.files[0];

        // --- Проверка наличия фото ---
        if (!file) {
          Swal.fire({
            title: "Ошибка",
            text: "Пожалуйста, сделайте фото сотрудника. Это обязательное поле.",
            icon: 'error',
            confirmButtonText: 'OK',
            confirmButtonColor: '#d32f2f'
          });
          btn.disabled = false;
          btn.textContent = "Закончить опрос";
          return;
        }

        // --- Расчет процента знаний ---
        const correctAnswersValues = {
          "q1_health": "Знает",
          "q2_hands": "Знает",
          "q3_cross_contam": "Знает",
          "q4_food_safety": "Знает",
          "q5_shelf_life": "Знает",
          "q6_safety_tech": "Знает",
          "q7_equipment_issues": "Знает",
          "q8_shift_goals": "Знает",
          "q9_greeting": "Знает",
          "q10_sales": "Знает",
          "q11_menu_knowledge": "Знает",
          "q12_cashier_standards": "Знает",
          "q13_order_accuracy": "Знает",
          "q14_farewell": "Знает",
          "q15_speed_service": "Знает",
          "q16_cleanliness": "Знает",
          "q17_communication": "Знает"
        };
        
        let score = 0;
        let totalQuestions = 0;
        for (const qName in correctAnswersValues) {
            totalQuestions++;
            const selectedValue = document.querySelector(`input[name="${qName}"]:checked`)?.value;
            if (selectedValue === correctAnswersValues[qName]) {
                score++;
            }
        }
        const percent = Math.round((score / totalQuestions) * 100);

        // --- Подготовка FormData для отправки всех данных (текст + файл) ---
        const formDataToSend = new FormData();
        formDataToSend.append("yourName", yourName);
        formDataToSend.append("employeeName", employeeName);
        formDataToSend.append("comment", comment);
        formDataToSend.append("Процент знаний", percent + "%"); // Отправляем процент как строку

        // Добавляем все ответы с радио-кнопок
        for (const qName in correctAnswersValues) {
            const selectedValue = document.querySelector(`input[name="${qName}"]:checked`)?.value || "";
            // Используем полный текст вопроса в качестве ключа для Google Таблицы
            // Важно, чтобы этот текст совпадал с заголовком столбца в таблице!
            let questionText = document.querySelector(`label[for="${qName}"]`)?.textContent.trim() || qName;
            // Здесь нужно жестко задать текст вопросов, если label for не используются или обрезаны
            // Пример: if (qName === "q1_health") questionText = "Нет видимых признаков заболевания...";
            // ИЛИ просто используйте полные тексты вопросов как ключи в formDataToSend.append,
            // как это было в вашем изначальном коде с formData для SheetDB.
            // Для простоты, давайте воспользуемся тем, что e.parameter в Apps Script
            // получит значения по `name` атрибутам радио-кнопок.
            // Так что, просто передаем их напрямую, а в Apps Script их будем извлекать по qName.
            formDataToSend.append(qName, selectedValue);
        }
        
        // Добавляем файл
        formDataToSend.append("cameraInput", file); // 'cameraInput' - имя поля type="file"

        // --- URL вашего Google Apps Script веб-приложения ---
        // !!! ЗАМЕНИТЕ ЭТОТ URL НА URL ВАШЕГО РАЗВЕРНУТОГО APPS SCRIPT ИЗ ШАГА 2 !!!
        const appsScriptUrl = 'https://script.google.com/macros/s/AKfycbw9YBQRMcCneylT8xNsDmfvTtsW68TXyhtIRWtiCp9QEmFya7nxIsUKfEG1hrJxn-hP/exec'; 

        // --- Отправка данных ---
        const response = await fetch(appsScriptUrl, {
          method: "POST",
          body: formDataToSend // FormData автоматически устанавливает Content-Type: multipart/form-data
        });

        const result = await response.json(); // Ожидаем JSON ответ от Apps Script

        if (response.ok && result.status === 'success') {
          Swal.fire({
            title: "HR - Опрос",
            html: `<b>Сотрудник:</b> ${employeeName}<br><b>Результат:</b> ${percent}%<br><b>Комментарий:</b><br>${comment}`,
            icon: 'success',
            confirmButtonText: 'OK',
            confirmButtonColor: '#d32f2f'
          });
          form.reset(); // Очищаем форму
        } else {
          console.error("Ошибка при отправке в Apps Script:", result);
          Swal.fire({
            title: "Ошибка",
            text: `Не удалось отправить данные: ${result.message || 'Неизвестная ошибка.'}`,
            icon: 'error',
            confirmButtonText: 'OK',
            confirmButtonColor: '#d32f2f'
          });
        }
      } catch (error) {
        console.error("Общая ошибка:", error);
        Swal.fire({
          title: "Ошибка",
          text: "Произошла непредвиденная ошибка. Проверьте консоль.",
          icon: 'error',
          confirmButtonText: 'OK',
          confirmButtonColor: '#d32f2f'
        });
      } finally {
        btn.disabled = false;
        btn.textContent = "Закончить опрос";
      }
    });
  </script>
</body>
</html>
